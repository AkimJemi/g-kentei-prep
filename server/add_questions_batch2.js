import pkg from 'pg';
const { Pool } = pkg;
const pool = new Pool({ connectionString:'postgresql://g_kentei_prep_app_db_user:0vZFHekJvsuMexPcBCKx5Ix4Noy7WZJO@dpg-d63nv6cr85hc73bckig0-a.oregon-postgres.render.com/g_kentei_prep_app_db', ssl:{rejectUnauthorized:false} });

const ML = '機械学習の概要';
const SOCIAL = 'AIの社会実装に向けて';

const questions = [
  // ===== 機械学習の概要 =====
  { cat:ML, q:'教師あり学習において「回帰問題」と「分類問題」の違いを正しく説明しているものはどれか。', opts:['回帰は画像を扱い、分類はテキストを扱う','回帰は連続値を予測し、分類は離散的なクラスを予測する','回帰は教師あり学習、分類は教師なし学習である','回帰は深層学習、分類は浅い学習で使われる'], ans:1, exp:'回帰問題は株価・気温・売上などの連続する数値を予測し、分類問題はスパム/非スパム・猫/犬などの離散的なカテゴリを予測します。どちらも教師あり学習の代表的タスクです。', optExp:['扱うデータ形式（画像・テキスト）での区別ではありません。','正解。回帰=連続値予測、分類=離散クラス予測が正しい区別です。','どちらも教師あり学習です。','使用するモデルの深さによる区別ではありません。'] },
  { cat:ML, q:'教師なし学習の代表的な手法として正しいものはどれか。', opts:['ロジスティック回帰','k-meansクラスタリング','ランダムフォレスト','サポートベクターマシン（SVM）'], ans:1, exp:'k-meansはデータをk個のクラスタに分ける教師なし学習の代表的アルゴリズムです。ロジスティック回帰・ランダムフォレスト・SVMはすべて教師あり学習の手法です。', optExp:['ロジスティック回帰は教師あり学習（分類）です。','正解。k-meansは教師なし学習（クラスタリング）の代表手法です。','ランダムフォレストは教師あり学習（アンサンブル）です。','SVMは教師あり学習（分類・回帰）です。'] },
  { cat:ML, q:'強化学習における「報酬（Reward）」の役割として正しいものはどれか。', opts:['エージェントの行動を直接指示するための命令','エージェントがある状態で行動した結果の良し悪しを数値で示し、方策の学習を導くシグナル','エージェントが観測する環境の状態そのもの','学習データのラベルのこと'], ans:1, exp:'強化学習の報酬は、エージェントが環境で行動した結果に対して環境から与えられる数値スカラーです。エージェントは報酬の累積合計（累積報酬）を最大化するように方策を学習します。', optExp:['行動を直接指示するのは命令であり、報酬は行動の結果の評価値です。','正解。報酬は行動の良し悪しを示す学習シグナルです。','環境の状態は「状態（State）」と呼ばれます。','ラベルは教師あり学習の概念です。'] },
  { cat:ML, q:'「汎化性能」の説明として正しいものはどれか。', opts:['学習データに対する予測精度の高さ','学習していない未知のデータに対しても正確に予測できる能力','モデルのパラメータ数の多さ','学習速度の速さ'], ans:1, exp:'汎化性能とは、モデルが学習データだけでなく、未見の新しいデータに対しても正確に予測できる能力です。過学習（学習データへの過剰適合）を防ぎ、汎化性能を高めることが機械学習の主要目標です。', optExp:['学習データでの精度は訓練精度と呼び、汎化性能とは異なります。','正解。未知のデータへの予測能力が汎化性能です。','パラメータ数はモデルの複雑さです。','学習速度は効率の指標です。'] },
  { cat:ML, q:'「バイアスとバリアンスのトレードオフ」の説明として正しいものはどれか。', opts:['学習率と正則化係数の間のトレードオフ','モデルの単純さ（高バイアス）と複雑さ（高バリアンス）の間にある精度への影響のトレードオフ','訓練データ量とテストデータ量のバランス','GPUとCPUの計算資源の配分'], ans:1, exp:'バイアス（モデルが単純すぎて学習不足）とバリアンス（モデルが複雑すぎて過学習）はトレードオフの関係にあります。適切な複雑さのモデルを選ぶことが汎化性能の向上に重要です。', optExp:['学習率と正則化係数は別の話です。','正解。モデルの単純さ（高バイアス）と複雑さ（高バリアンス）のトレードオフです。','データ分割の比率は別の話です。','GPU/CPUの配分は計算資源の話です。'] },
  { cat:ML, q:'「グリッドサーチ（Grid Search）」の目的として正しいものはどれか。', opts:['データを格子状に可視化して分析すること','ハイパーパラメータの候補値の組み合わせを全列挙して最良の組み合わせを探索すること','ニューラルネットワークのグリッド型アーキテクチャを設計すること','データを格子状に分割してアノテーションすること'], ans:1, exp:'グリッドサーチはハイパーパラメータ（学習率・木の深さ等）の候補を格子状（全組み合わせ）で試し、Cross Validationで各組み合わせを評価して最良のハイパーパラメータを見つける手法です。', optExp:['データの可視化手法ではありません。','正解。ハイパーパラメータの全組み合わせを探索して最適値を見つける手法です。','アーキテクチャ設計ではありません。','アノテーションの手法ではありません。'] },
  { cat:ML, q:'「ドロップアウト（Dropout）」の主な目的はどれか。', opts:['学習時にニューロンをランダムに無効化することで過学習を防ぐ正則化手法','ニューラルネットワークのレイヤーを削除してモデルを軽量化すること','不要なデータを学習前に除去すること','不活性なニューロンを削除してメモリを節約すること'], ans:0, exp:'ドロップアウトは学習の各ステップでランダムに一定割合のニューロンを非活性化する正則化手法です。特定のニューロンへの過度な依存を防ぎ、過学習を抑えることができます。テスト時は全ニューロンを使用します。', optExp:['正解。ランダムなニューロン無効化で過学習を防ぐ正則化手法です。','レイヤー削除ではなくニューロンの一時的な無効化です。','データ除去はデータ前処理の話です。','恒久的削除ではなく学習時の一時的な無効化です。'] },
  { cat:ML, q:'決定木において「剪定（プルーニング）」を行う目的はどれか。', opts:['決定木の葉ノードを新たに追加して精度を高めること','過学習を防ぐために木の複雑さ（深さ・分岐数）を制限・削減すること','決定木のデータを暗号化して秘匿すること','学習速度を最大化するために木の深さを増やすこと'], ans:1, exp:'剪定（プルーニング）は決定木が学習データに過剰適合（過学習）するのを防ぐため、不要な枝や葉を取り除いてモデルを単純化する操作です。事前剪定（成長を早期停止）と事後剪定（学習後に枝を削除）があります。', optExp:['葉ノードの追加は木を複雑にし、過学習につながります。','正解。過学習防止のため木を単純化する操作が剪定です。','暗号化はセキュリティの話です。','深さを増やすことは剪定の逆の操作です。'] },
  { cat:ML, q:'「転移学習（Transfer Learning）」の説明として正しいものはどれか。', opts:['学習したモデルを別のコンピュータに転送すること','あるタスクで学習済みのモデルの知識を、別の関連タスクに再利用すること','データをクラウドから本番環境に転送すること','強化学習における方策の更新手法のこと'], ans:1, exp:'転移学習とは、大規模データで事前学習（Pre-training）したモデルの重みを、データの少ない別タスクに再利用する手法です。ImageNet学習済みモデルを医療画像に適用するケースが典型例です。', optExp:['モデルファイルの転送ではありません。','正解。事前学習済みモデルの知識を別タスクに再利用することです。','データ転送はインフラの話です。','方策更新は強化学習の話です。'] },
  { cat:ML, q:'「アンサンブル学習」の基本的な考え方として正しいものはどれか。', opts:['1つの非常に大きなモデルで高精度な予測を行うこと','複数の学習器（モデル）の予測を組み合わせることで、単体モデルより高い精度を実現する手法','データを複数のグループに分けて学習する手法','1つのモデルに複数のデータセットを与えること'], ans:1, exp:'アンサンブル学習は複数の弱い学習器を組み合わせることで、個々のモデルより高い汎化性能を実現する手法です。バギング（ランダムフォレスト）、ブースティング（AdaBoost・XGBoost）、スタッキングが代表例です。', optExp:['1つの大きなモデルはアンサンブルではありません。','正解。複数モデルの組み合わせで精度向上を図る方法がアンサンブル学習です。','データ分割は交差検証や前処理の話です。','複数データセットを使うこととアンサンブルは異なる概念です。'] },
  { cat:ML, q:'教師あり学習で使用する「損失関数（Loss Function）」の役割として正しいものはどれか。', opts:['モデルの推論速度を測定する関数','モデルの予測値と正解値の乖離（誤り）を数値化し、学習の方向性を定める関数','学習データを前処理する関数','モデルのパラメータ数を計算する関数'], ans:1, exp:'損失関数はモデルの予測値と正解ラベルの差（誤差）を数値化する関数です。学習では損失関数を最小化するようにパラメータを更新します。回帰では平均二乗誤差（MSE）、分類では交差エントロピー損失が代表的です。', optExp:['推論速度の測定はパフォーマンス計測の話です。','正解。予測と正解の乖離を数値化し学習方向を定める関数です。','前処理関数とは異なります。','パラメータ数の計算は損失関数の役割ではありません。'] },
  { cat:ML, q:'「特徴量の重要度（Feature Importance）」が高いことの意味として正しいものはどれか。', opts:['その特徴量のデータ量が多いこと','その特徴量がモデルの予測に大きく貢献していること','その特徴量の値が大きいこと','その特徴量が最初に作成されたこと'], ans:1, exp:'特徴量の重要度とは、その変数・特徴がモデルの予測精度にどれだけ影響を与えているかを示す指標です。重要度が高い特徴量はモデルの判断に大きく貢献しており、この分析により解釈可能性やモデル改善のヒントが得られます。', optExp:['データ量の多さとは異なります。','正解。モデルの予測への貢献度が高いことを意味します。','値の大きさとは無関係です。','作成順序とは無関係です。'] },
  { cat:ML, q:'「ハイパーパラメータ」と「モデルパラメータ」の違いとして正しいものはどれか。', opts:['ハイパーパラメータはデータから学習し、モデルパラメータは人間が設定する','モデルパラメータはデータから学習され、ハイパーパラメータは学習前に人間が設定する','どちらもデータから自動的に学習される','どちらも人間が手動で設定する'], ans:1, exp:'モデルパラメータ（重み・バイアス等）は学習データから自動的に更新・決定されます。ハイパーパラメータ（学習率・隠れ層数・正則化係数等）は学習前に人間が設定する設計上の選択肢で、学習中は固定されます。', optExp:['逆の説明です。','正解。モデルパラメータ=学習で決定、ハイパーパラメータ=人間が事前設定です。','ハイパーパラメータは学習で自動決定されません。','モデルパラメータは学習で自動決定されます。'] },
  // ===== AIの社会実装に向けて =====
  { cat:SOCIAL, q:'「PoC（Proof of Concept）から本番化」への移行でよく発生する問題として代表的なものはどれか。', opts:['PoCで使ったモデルが優秀すぎて本番環境でも問題が起きること','PoCでは良い精度だったが、本番環境の実データや規模・運用要件への対応で課題が生じること','本番化するとデータが自動的に消去されること','本番化するとAIモデルのライセンスが切れること'], ans:1, exp:'PoCから本番化への移行では、①本番データの多様性・ノイズへの対応、②大規模データ処理の性能、③セキュリティ・コンプライアンス要件、④継続的な運用保守体制の整備、⑤既存システムとの連携など多くの実課題が発生します。', optExp:['PoCモデルが優秀すぎることは問題になりません。','正解。本番環境の実条件・規模・運用要件への対応が典型的な課題です。','データの自動消去はセキュリティ設定の問題です。','モデルのライセンス切れは本番化の一般的な問題ではありません。'] },
  { cat:SOCIAL, q:'AIプロジェクトで「スモールスタート」が推奨される理由として最も適切なものはどれか。', opts:['コストが少ないとAIの精度が上がるから','小規模で素早く仮説検証を行い、リスクを抑えながら学習・改善を繰り返すことができるから','少ないデータでも必ず高精度なAIが作れるから','法律でAIの初期規模が制限されているから'], ans:1, exp:'スモールスタートは最小限の投資で素早く検証し、成果が確認できてから規模を拡大する進め方です。AIプロジェクトは不確実性が高いため、大規模投資前にPoCで学びを得ることでリスクと浪費を最小化できます。', optExp:['コストと精度は直接的な相関はありません。','正解。小規模な仮説検証でリスクを抑えて学べることがスモールスタートの利点です。','少ないデータで高精度が保証されるわけではありません。','スモールスタートを法律が義務付けているわけではありません。'] },
  { cat:SOCIAL, q:'AIシステムの「シャドウモード（Shadow Mode）デプロイ」の説明として正しいものはどれか。', opts:['AIシステムを夜間だけ稼働させる節電モード','新旧システムを並行稼働させ、AIの予測結果を実際の業務判断には使わず検証目的で観察するデプロイ方法','AIシステムを完全に非公開で開発するモード','AIモデルを匿名化してデプロイする方法'], ans:1, exp:'シャドウモードデプロイは、本番環境で新AIシステムを稼働させながら、その予測結果を実際の意思決定に使わず旧システムと並行して監視・比較する手法です。安全に本番データでの検証ができます。', optExp:['夜間限定稼働とは異なります。','正解。本番並行稼働で実際の判断には使わず観察するデプロイ方法です。','開発の非公開性のことではありません。','匿名化とは異なります。'] },
  { cat:SOCIAL, q:'「AI活用の倫理審査委員会（IRB相当）」を設置する主な目的はどれか。', opts:['AIシステムの性能を向上させること','AIプロジェクトが倫理的・社会的リスクを適切に管理しているか組織的にレビューすること','AIシステムの開発コストを削減すること','AIエンジニアの採用活動を行うこと'], ans:1, exp:'AI倫理審査は医療・採用・金融等の高リスクAIプロジェクトが、プライバシー・公平性・安全性・説明可能性などの観点から倫理的に適切に進められているか、組織横断的に評価・監視するための仕組みです。', optExp:['性能向上は開発チームの役割です。','正解。倫理的・社会的リスクの組織的レビューが目的です。','コスト削減は倫理審査委員会の目的ではありません。','採用活動は人事部門の役割です。'] },
  { cat:SOCIAL, q:'AIシステムのKPIモニタリングにおいて「コンセプトドリフト」が検知された場合の適切な対応はどれか。', opts:['AIシステムを即座にシャットダウンする','モデルの再学習や予測ロジックの見直しを行う','データをすべて削除して最初からやり直す','ユーザーにシステムの使用を禁止する'], ans:1, exp:'コンセプトドリフトは予測対象の本質（入力-出力の関係）が時間とともに変化することで、モデルの精度が低下する現象です。検知した場合は新しい傾向を反映したデータでモデルを再学習するか、予測ロジック自体を見直す対応が必要です。', optExp:['即座のシャットダウンはビジネス継続性の観点から適切ではありません。','正解。再学習やロジックの見直しが適切な対応です。','すべてのデータ削除は過度な対応です。','ユーザー禁止はビジネスを止めてしまいます。'] },
  { cat:SOCIAL, q:'「AIシステムの説明書（AI Product Card / Model Card）」を公開する目的として最も適切なものはどれか。', opts:['AIシステムの特許を取るため','AIシステムの目的・性能・限界・使用制約・倫理的配慮等を透明性をもって開示する', 'AIシステムの価格を公表するため','AIシステムの開発チームメンバーを公開するため'], ans:1, exp:'Model CardやAI Product Cardとは、AIシステムの用途・評価データセット・性能指標・バイアス評価・想定する使用制約などを文書化して公開するものです。Googleが提唱し、AI透明性・信頼性向上のための実践として広まっています。', optExp:['特許申請とは別の文書です。','正解。AI透明性向上のためシステムの性能・限界・倫理的配慮を開示する文書です。','価格公表とは異なります。','チームメンバー公開とは異なります。'] },
];

async function main() {
  const client = await pool.connect();
  try {
    let count = 0;
    for (const q of questions) {
      await client.query(
        `INSERT INTO g_kentei_questions (category,question,options,correctAnswer,explanation,optionExplanations,source) VALUES ($1,$2,$3,$4,$5,$6,'system')`,
        [q.cat, q.q, JSON.stringify(q.opts), q.ans, q.exp, JSON.stringify(q.optExp)]
      );
      count++;
      process.stdout.write(`\r追加中: ${count}/${questions.length}`);
    }
    console.log(`\n✅ ${count}問追加完了`);
    const res = await client.query(`SELECT c.title, COUNT(q.id) as cnt FROM g_kentei_categories c LEFT JOIN g_kentei_questions q ON q.category=c.id WHERE c.id IN ($1,$2) GROUP BY c.title`, [ML, SOCIAL]);
    res.rows.forEach(r => console.log(`  ${r.title}: ${r.cnt}問`));
  } finally {
    client.release();
    await pool.end();
  }
}
main().catch(console.error);
