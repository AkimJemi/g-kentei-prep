import pkg from 'pg';
const { Pool } = pkg;

const connectionString = 'postgresql://g_kentei_prep_app_db_user:0vZFHekJvsuMexPcBCKx5Ix4Noy7WZJO@dpg-d63nv6cr85hc73bckig0-a.oregon-postgres.render.com/g_kentei_prep_app_db';
const pool = new Pool({
  connectionString,
  ssl: { rejectUnauthorized: false }
});

const enrichment = {
    // Missing IDs from Batch 1-2 (31-40, 94-100)
    31: ["第3次AIブームの中心であり、現代AIの基盤となる技術です。", "第2次ブームの核となった、専門知識をルールで表現する手法です。", "第3次ブームを支えるインフラ的な要素です。", "データの量を表す言葉ですが、技術の名称ではありません。"],
    32: ["画像認識のコンペ（ILSVRC）において、DLが圧倒的な結果を出した有名なコンペです。", "データ分析全般のコンペプラットフォームです。", "ロボット競技会です。", "主催組織の名称です。"],
    33: ["AIが人間の知能を超える技術的特異点です。", "宇宙の始まりです。", "ネットによる変革です。", "仮想空間の総称です。"],
    34: ["1997年にチェスで世界王者に勝利したAIです。", "2011年にクイズで勝利したAIです。", "スパコンの名前です。", "架空のAIです。"],
    35: ["判断の根拠や過程が人間には理解できない状態を指します。", "特定の能力は高いが社会的常識が欠如している状態の例えです。", "SF映画のタイトルです。", "否定的な表現で、一般的ではありません。"],
    36: ["現代の国家戦略として妥当な目標値です。", "過小な目標です。", "極端に多い目標です。", "全学生人口に近い数字です。"],
    37: ["量・多様性・速度の3Vを備えた巨大なデータ群です。", "公開されているデータのことです。", "モノのインターネットのことです。", "分散型台帳技術です。"],
    38: ["研究が停滞し、期待値が下がった時期を指します。", "秋とは言いません。", "氷河期とも言いますが、専門用語は冬です。", "意味は通じますが、専門用語ではありません。"],
    39: ["イ・セドル対AlphaGoの歴史的な戦いが行われた地です。", "別の対局地です。", "対局候補地の一種です。", "Googleの拠点ですが、対局場所ではありません。"],
    40: ["Transformerを提案し、現代AIを定義した歴史的論文です。", "ResNetの論文です。", "ResNetに関連する用語です。", "AlexNetのモデル名です。"],
    
    94: ["入力画像をいくつかの領域に分割（グリッド化）し、それぞれの領域に注目する手法です。", "画像を小さなパッチに分ける手法です（ViTに近い）。", "RNNでの情報の保持手法です。", "CNNのカーネルの別名です。"],
    95: ["画像の中の物体を囲み、クラスを特定するタスクです。", "画像全体に1つのラベルを付けるタスクです。", "ピクセル単位で正確に塗り分けるタスクです。", "情報を圧縮する手法です。"],
    96: ["自然言語などの順序のあるデータです。", "画像のような格子状のデータです。", "グラフ構造のデータです。", "空間的なデータです。"],
    97: ["系列データの順序情報を伝えるために加える位置情報です。", "注意の重みを計算する層です。", "層を正規化する手法です。", "接続を切る手法です。"],
    98: ["文脈全体を見て、どの単語が重要かを計算する仕組みです。", "前の状態をそのまま引き継ぐRNNの機能です。", "フィルターをかけるCNNの機能です。", "ノイズを除去する機能です。"],
    99: ["入力にランダムな微小ノイズ（摂動）を加え、モデルを誤認させる攻撃です。", "データを盗み出す技術です。", "学習を止める攻撃です。", "偽のアカウントを作る攻撃です。"],
    100: ["攻撃による誤認を防ぐための、堅牢な学習手法です。", "敵対的サンプルの生成手法です。", "データを暗号化する手法です。", "アクセスを制限する手法です。"],

    // Math & Stats / Law (151-183)
    151: ["ベクトルの「長さ」や「大きさ」を表す数学的な指標です。", "大きさのみを持つ量（1次元の値）です。", "多次元のデータ配列のことです。", "ベクトルの内積計算の結果です。"],
    152: ["確率論の基本性質で、すべての起こりうる事象の確率は合計1になります。", "ありえない事象の確率です。", "パーセント表示の場合の値です。", "確率は0から1の範囲で有限です。"],
    153: ["ガウス分布とも呼ばれる、平均を中心に左右対称に広がる形です。", "指数分布のような形です。", "負の相関がある形です。", "カテゴリ値などの離散的な図です。"],
    154: ["試行回数を増やすほど標本平均が母平均に近づくという統計学の基本法則です。", "標本分布が正規分布に近づく定理です。", "極限での収束に関する数学的議論です。", "データを一定範囲に収める手法です。"],
    155: ["線形変換によって方向が変わらないベクトルに掛かる倍率（スカラー値）です。", "方向が変わらないベクトルのことです。", "行列の数値的特徴を示す一つの値です。", "対角要素の和です。"],
    156: ["瞬間の変化率や接線の傾きを求める計算です。", "面積や累積を求める微分と逆の計算です。", "限りなく近づける操作です。", "累乗の指数を逆転させたものです。"],
    157: ["多くの要素が0である（密度が低い）状態を指します。", "要素が詰まっている状態です。", "逆行列が存在しない状態です。", "角度が90度の状態です。"],
    158: ["内積は cos(θ) に比例し、cos(90°) = 0 となるためです。", "平行（0度）でノルムが1の場合の値です。", "逆向き（180度）の場合の値です。", "発散はしません。"],
    159: ["複数の特徴量（説明変数）を使って1つの値を予測する回帰です。", "説明変数が1つだけの回帰です。", "0か1の確率を予測する分類手法です。", "非線形な境界を作る回帰です。"],
    160: ["データの分類（S字曲線）に使用される、統計学・機械学習の基本手法です。", "連続値を予測する直線的な手法です。", "複数の変数を使う回帰です。", "外れ値に強い回帰手法です。"],
    161: ["正規分布（Normal Distribution）を平均μ、分散σ²で表す標準的な記法です。", "確率（Probability）の略で、分布全体の表記ではありません。", "ガウス分布（Gaussian）ですが、引数の順序が一般的ではありません。", "分布（Distribution）の略記ですが、一般的ではありません。"],
    162: ["要素ごとの積の和をとることで、ベクトルの向きの近さを判定できます。", "内積で次元は増えません（スカラーになります）。", "反転はマイナスを掛ける操作です。", "正規化はノルムで割る操作です。"],
    163: ["著作権は「思想又は感情を創作的に表現したもの」に認められるため、AIが無意識に生成したものには原則認められません。", "人間が全く関与しない生成物には認められません。", "法律の問題であり、個別の課金状況は関係ありません。"],
    164: ["AI学習のための情報解析であれば、著作権者の利益を不当に害さない範囲で、許諾なく利用できる条項です。", "コピーして売る行為は侵害になります。", "海賊版の利用は推奨されず、別の法的問題が生じます。", "限定的に許可されています。"],
    165: ["公共の利益や法的義務がある場合は、同意なしの提供が認められる例外規定があります。", "マーケティングや営利目的では同意が必須です。", "個人的・SNS的な理由は正当な理由になりません。"],
    166: ["善良な管理者の注意をもって業務を遂行する義務です。完成そのものは保証しません。", "請負契約に特有の義務です。", "請負や売買で見られる、欠陥に対する責任です。", "発明者の権利であり、委任の義務とは別です。"],
    167: ["顧客リストや独自の製法など、秘密管理されている有用な情報を保護します。", "デザインを保護する権利です。", "名称やロゴを保護する権利です。", "技術的アイデアを保護する権利です。"],
    168: ["既存の著作物を元にしたことが明らかで、表現が似ている場合は侵害とみなされます。", "侵害していない適正な利用のことです。", "新しい価値を生むことですが、模倣は侵害です。"],
    169: ["自分のデータを学習に使わせないように意思表示し、除外させる仕組みです。", "事前に同意を得て追加する仕組みです。", "Webの追跡技術です。", "守秘義務契約です。"],
    170: ["Non-Disclosure Agreement（秘密保持契約）の略称です。", "サービスの品質保証に関する合意です。", "利用規約です。", "エンドユーザー向けのライセンス許諾です。"],
    171: ["Service Level Agreement（サービス品質合意）。稼働率などの指標を定めます。", "重要業績評価指標（目標数値）です。", "投資利益率（コストパフォーマンス）です。", "概念実証（検証工程）です。"],
    172: ["EU域内にいる個人の情報を扱う場合、世界のどの企業にも適用される厳しい規則です。", "EUに関係するデータに限定されます。", "アメリカに限ったものではありません。", "日本の法律は個人情報保護法です。"],
    173: ["発明（高度な技術的アイデア）を保護し、公開の代償として独占権を与えます。", "デザイン（外観）を保護します。", "ロゴや商標（ブランド）を保護します。", "小規模な発明を保護します。"],
    174: ["契約において、成果物の所有権や知的財産権が誰に属するかを明確にします。", "他人に権利を移すことです。", "使う権利（ライセンス）を認めることです。"],
    175: ["特定の個人を識別できないようにし、かつ復元もできないように加工した情報です。", "他の情報と照合して識別できる可能性をわずかに残したものです。", "単なる全体集計値です。", "特定個人の特定を難しくしただけの状態です。"],
    176: ["人月単価など、実際に作業した「時間と材料（人）」に対して対価を払う方式です。", "一括で決まった金額を払う方式です。", "無料ではありません。"],
    177: ["AIの回答の正確性などを保証せず、損害についても責任を負わない旨の記載です。", "サービスの使い道全般を定めたものです。", "修理などの保証期間を定めたものです。"],
    178: ["自分の顔や姿を勝手に撮影・公表されないように求める権利です。", "作品の表現を守る権利です。", "有名人の顧客吸引力を守る権利です。"],
    179: ["電子マネーの発行や送金サービスを適切に管理するための法律です。", "株や投資を制限する法律です。", "市場の独占を防ぐ法律です。", "不当な広告を制限する法律です。"],
    180: ["消費者を欺くような宣伝や、過大な景品による誘引は厳しく制限されています。", "適正な範囲であれば許可されます。"],
    181: ["著作権は「表現」を保護するものであり、その背後にある「アイデア（解法）」は保護対象外です。", "アイデアは特許などの範疇ですが、著作権にはありません。"],
    182: ["Open Source Software。誰もが得られ、改修や再配布が可能な権利形態です。", "有料で制限がある形態です。", "特定の企業が独占する形態です。"],
    183: ["学習データに含まれる偏りが原因で、AIが不当な判断を下してしまう問題です。", "物理的な障害を除去することです。", "多様性を尊重することです。"]
};

async function bulkEnrich() {
    console.log('[Bulk Enrich] Updating optionExplanations for Batch 4 (IDs 31-40, 94-100, 151-183)...');
    try {
        let updatedCount = 0;
        for (const [id, exps] of Object.entries(enrichment)) {
            const res = await pool.query(
                `UPDATE g_kentei_questions SET optionExplanations = $1 WHERE id = $2`,
                [JSON.stringify(exps), id]
            );
            if (res.rowCount > 0) {
                updatedCount++;
            }
        }
        console.log(`[Bulk Enrich] Successfully updated ${updatedCount} questions.`);
    } catch (err) {
        console.error('[Bulk Enrich] Error:', err.message);
    } finally {
        await pool.end();
    }
}

bulkEnrich();
