import pkg from 'pg';
const { Pool } = pkg;

const connectionString = 'postgresql://g_kentei_prep_app_db_user:0vZFHekJvsuMexPcBCKx5Ix4Noy7WZJO@dpg-d63nv6cr85hc73bckig0-a.oregon-postgres.render.com/g_kentei_prep_app_db';
const pool = new Pool({
  connectionString,
  ssl: { rejectUnauthorized: false }
});

const enrichment = {
    101: ["画像全体で同じ重みを使い回す「重み共有」と、局所的に結合する「局所受容野」がパラメータ削減の鍵です。", "画像サイズを圧縮する処理ですが、主要なパラメータ削減理由は重み共有です。", "過学習を防ぐためにランダムにニューロンを無効化する手法です。", "学習を安定化・高速化させるための正規化手法です。"],
    102: ["新しい情報をセルに取り込む割合を決めます。", "ゲートが閉じることで、過去の不要な情報を遮断し「忘却」させます。", "隠れ層に出力する情報を制御します。", "GRUで使われるゲートで、過去の状態をどの程度無視するかを決めます。"],
    103: ["単語を意味の近いもの同士が近くに配置されるような高次元ベクトルに変換します。", "文を最小単位（単語等）に分割する処理です。", "文の構造（主語、述語等）を解析する処理です。", "表記揺れなどを修正し、形式を整える処理です。"],
    104: ["RNNを使わず、注意機構のみで系列データを処理する革新的なモデルです。", "TransformerのEncoder部分をベースにしたモデルですが、提案は2018年です。", "CNNの一種で、スキップ接続を導入した画像認識モデルです。", "Transformer以前に主流だった、時系列データを扱う再帰的モデルです。"],
    105: ["OpenAIが開発した単方向の言語モデルです。", "文の前後（双方向）から文脈を学習し、多様なタスクで高い精度を示したモデルです。", "複数のタスクを一つのモデルで解くText-to-Text Transfer Transformerです。", "Googleが開発した次世代のLLMですが、BERTより後のモデルです。"],
    106: ["外部データベースから情報を検索し、それを元に回答を生成する手法です。", "追加のデータで既存モデル全体を微調整することです。", "AIに悪意のある入力を与えて制限を突破させる攻撃手法です。", "大きなモデルから小さなモデルへ知識を移す技術です。"],
    107: ["テキストから音声を生成する技術（TTS）です。", "音声データを解析し、テキストに変換する技術（ASR）です。", "テキストデータを生成するAIの機能です。", "ユーザーが何をしたいか（質問、命令等）を解釈することです。"],
    108: ["単語や文を数値ベクトル化したもので、意味の近さを計算できます。", "文を分割した最小単位（単語や文字の断片）です。", "ユーザーがAIに与える指示文です。", "AIが処理する際に考慮する周囲の情報や背景です。"],
    109: ["AIから期待通りの出力を得るために指示文を工夫する技術です。", "特定のデータでモデルを微調整することです。", "データを数値（ベクトル）に変換することです。", "プログラムの誤り（バグ）を修正することです。"],
    110: ["例示を全く与えずにタスクを解かせることです。", "数個（few）の具体例をプロンプトに含めて解かせる手法です。", "全パラメータを再学習させる通常のチューニングです。", "大規模データで基礎的な知識を学習させる段階です。"],
    111: ["低ランク行列を導入し、ごく一部の重みだけを学習させる効率的な手法です。", "すべての重みを微調整する通常のファインチューニングです。", "重みの精度（ビット数）を下げて軽量化する手法です。", "不要なニューロンや接続を削除して軽量化する手法です。"],
    112: ["画像とテキストの関連性を学習し、ゼロショットでの画像分類などが可能なモデルです。", "OpenAIの画像生成モデルですが、生成そのものが主目的です。", "高品質な画像を生成するAIサービス名です。"],
    113: ["もっともらしい嘘（事実と異なる内容）を自信満々に出力する現象です。", "訓練データに合わせすぎて未知データに対応できないことです。", "データやモデルの偏りのことです。", "時間の経過とともにデータの性質が変化し、モデルの精度が落ちることです。"],
    114: ["ニューラルネットワークを用いた現代の主流な翻訳方式です。", "ルール（文法辞書）に基づく古い翻訳方式です。", "大量の対訳データから統計的に翻訳する方式です。", "過去の翻訳事例を検索・修正して利用する方式です。"],
    115: ["クラス（カテゴリ）ごとに塗り分けますが、個体までは区別しません。", "同じクラスであっても、個々の物体を別々のインスタンスとして識別し塗り分けます。", "物体を四角い枠（バウンディングボックス）で囲むだけの手法です。", "画像全体が何であるかを当てるだけのタスクです。"],
    116: ["複数のセンサー情報を統合し、単一のセンサーより高精度・高信頼な認識を行う技術です。", "データを加工して種類を増やす手法です。", "複数のモデルの予測を組み合わせる手法です。", "故障に備えて構成を二重以上にすることです。"],
    117: ["音声を解析しテキスト化する技術です。", "テキストデータから人間のような自然な音声を生成する技術です。", "音声の波形や特徴を分析することです。", "信号からノイズを除去したり変換したりすることです。"],
    118: ["一度に入力（考慮）できるトークン（単語の断片）の最大範囲です。", "モデルの学習された重みの数です。", "ハードウェア側の記憶容量を指す一般的な言葉です。", "一度の学習ステップに使うデータの数です。"],
    119: ["画像を小さな正方形（パッチ）に分割し、それを系列データとして扱います。", "画像を構成する最小の点です。", "画像から特徴を抽出するために重ね合わせる小さな行列です。", "フィルタと同様、畳み込みで使われるカーネルです。"],
    120: ["テキストなどから動画を生成するAIです。", "静止画を生成するAIです。", "立体の3Dデータを生成するAIです。", "音や音楽を生成するAIです。"],
    121: ["人間の価値観や意図に沿うようにモデルを調整するプロセスです。", "ラベルなしデータで基礎知識を学ぶ段階です。", "モデルを小型化する技術です。", "モデルを軽量化する技術です。"],
    122: ["特定のタスク用ではなく、汎用的な知識を大規模データから学ぶ最初の工程です。", "特定のタスクに合わせて微調整する第2段階の工程です。", "学習済みモデルを別のドメインに適用することです。"],
    123: ["最小限の機能を持つ製品版のことです。", "概念実証（Proof of Concept）。技術やアイデアが実現可能か検証する工程です。", "開発最終段階の試用版です。", "機能やデザインを確認するための試作品です。"],
    124: ["IT全般の運用効率化です。", "機械学習モデルの構築から本番運用までを円滑に回すための仕組みや体制です。", "データ管理に特化した運用管理です。", "従来のソフトウェア開発と運用の連携です。"],
    125: ["時間経過とともにデータの性質（概念）が変わり、予測が外れやすくなることです。", "再学習しても精度が戻らないような状態です。", "プログラムのミスです。"],
    126: ["構築にかかる費用です。", "学習させるためのデータを用意する費用です。", "リリース後のサーバー代やメンテナンス費用です。", "ROIを算出する際は、これらすべてのトータルコストを投資額(I)と考えます。"],
    127: ["一定期間（スプリント）を区切り、開発とレビューを繰り返します。", "大きな工程（設計、開発、テスト等）の区切りです。", "特定の重要な到達地点です。"],
    128: ["一般的な知識を学ぶことです。", "システム導入による業務や組織の変化を管理し、現場の混乱を防ぎ定着を促す活動です。", "操作方法などの技術的な支援です。"],
    129: ["一般的な用語であり、特定の指針名とは異なります。", "企業がAIを導入・運用する際の具体的なガバナンス体制についての報告書です。", "デジタルトランスフォーメーションの課題を整理した資料です。"],
    130: ["故障やエラー時に、システムをあえて安全な状態（停止や制限動作）にする設計思想です。", "データをコピーしておくことです。", "構成を二重以上にすることです。"],
    131: ["データのライフサイクル全体を適切に組織・管理する活動です。", "データから有用なパターンを見つけ出す技術です。", "加工前の生のデータを溜めておく場所です。"],
    132: ["AIをどの場面でどのように使うか、具体的な利用シーンを定義することです。", "システムが満たすべき機能や性能を定義することです。"],
    133: ["潜在的なリスクを予測し、その影響を評価・対策することです。", "工程の進みを管理することです。", "品質（正解率や安定性）を管理することです。"],
    134: ["AIの学習や運用において、重要な判断や修正に人間が介在する仕組みです。", "人間が機械を操縦することです。", "人間が関与しない状態です。"],
    135: ["稼働中の精度やシステム負荷を継続的に監視することです。", "活動記録（ログ）を残すことです。", "データの由来や処理過程を遡れるようにすることです。"],
    136: ["AIは道具であり、それ自体が責任を負うことは現在の法体系ではありません。", "技術的な責任はありますが、社会的・最終的な責任主体は事業者（提供者）です。", "事業者が中心的な責任を負います。"],
    137: ["人件費などの固定経費です。", "生産量に応じて増減する経費です。", "材料費など直接必要な経費です。"],
    138: ["データの整備や組織文化など、AIを効果的に導入できる土壌が整っている状態です。", "従来のIT化ができている状態です。"],
    139: ["インターネットを通じて不特定多数の人にアノテーションなどの作業を依頼する手法です。", "短期間で集中して開発を行うイベントです。"],
    140: ["既存システムの老朽化（レガシーシステム）がDXの足枷となり、2025年以降に多額の経済損失が生じるとされる警告です。", "AIの進化による市場の混乱を指す言葉ではありません。"],
    141: ["個人や企業のデータを預かり、適切なルールの下で第三者に提供・流通させる仲介組織です。", "特定の企業が必要なデータをやり取りする場です。", "誰でも自由に使える公開データです。"],
    142: ["既存の技術やビジネスモデルを破壊し、全く新しい価値を生み出すことです。", "技術的、社会的な新結合（新しい試み）のことです。"],
    143: ["全数値を合計して個数で割った値です。", "数値を小さい順に並べたとき、ちょうど真ん中にくる値です。外れ値に強いです。", "最も頻繁に現れる値です。"],
    144: ["平均からのズレの2乗の平均で、データの散らばり具合を示します。", "平均からどれくらい離れているかを示すスコアです。", "得られる値の平均的な見込みです。"],
    145: ["2つの変数の比例関係の強さを示す指標です。1に近ければ正の相関、-1なら負の相関です。", "モデルがいかにデータに適合しているかを示す指標です。"],
    146: ["事象Aが起こったという前提（条件下）で、事象Bが起こる確率です。", "AとBが同時に起こる確率です。", "ある特定の事象のみに注目した確率です。"],
    147: ["事前確率（もともとの推測）に情報を加え、事後確率を求めるための基本公式です。", "直角三角形の辺の長さに関する定理です。", "サンプル数が増えると分布が正規分布に近づく定理です。"],
    148: ["合成関数の微分において、内側の関数の微分を掛け合わせるルールのことです。", "積の関数の微分ルールです。"],
    149: ["行列の全ての要素を逆数にしたものではありません。かけ合わせると単位行列になる行列です。", "行と列をそっくり入れ替えた行列です。", "対角成分以外がすべて0の行列です。"],
    150: ["関数の値が最も急激に減少する方向（勾配と逆向き）に重みを更新し、最小値を探索する手法です。", "方程式の根を求める反復法です。", "誤差の2乗和を最小にする手法です。"]
};

async function bulkEnrich() {
    console.log('[Bulk Enrich] Updating optionExplanations for IDs 101-150...');
    try {
        let updatedCount = 0;
        for (const [id, exps] of Object.entries(enrichment)) {
            const res = await pool.query(
                `UPDATE g_kentei_questions SET optionExplanations = $1 WHERE id = $2`,
                [JSON.stringify(exps), id]
            );
            if (res.rowCount > 0) {
                updatedCount++;
            }
        }
        console.log(`[Bulk Enrich] Successfully updated ${updatedCount} questions.`);
    } catch (err) {
        console.error('[Bulk Enrich] Error:', err.message);
    } finally {
        await pool.end();
    }
}

bulkEnrich();
